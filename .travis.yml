language: cpp

os:
  - linux
  - osx

compiler:
  - gcc
  - clang

sudo: false

git:
  depth: 1

before_install:
  - gem install md2man --no-rdoc --no-ri
  - chmod +x ./install-dependencies.sh
  - ./install-dependencies.sh

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-precise-3.7
    packages:
      - gcc-5
      - g++-5
      - clang-3.7
      - gettext
      - libhiredis-dev

install:
  # install some packages from Ubuntu's default sources
  - if [[ $CXX == 'g++' ]]; then export CXX="g++-5" CC="gcc-5"; fi
  - if [[ $CXX == 'clang++' ]]; then export CXX="clang++-3.7"; fi

#FIXME: removes -Werror flag for osx check
script:
  # make distcheck still does not work on travis
  - mkdir build
    && cd build
    && cmake ..
    && make VERBOSE=1
    && (make test || true)

after_script:
  - if test -f ./Testing/Temporary/LastTest.log; then
      echo "cat test logs:";
      cat  ./Testing/Temporary/LastTest.log;
    fi